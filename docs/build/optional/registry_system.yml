- id: registry_system.overview
  kind: overview
  md: |
    registry_system defines LillyCORE’s Phase Registry System as an optional build-time index.

    Purpose:
    - Provide a predictable way for tools and GPTs to discover phases/slices and their relationships.
    - Define a stable schema for registry files and a thin script interface for safe updates.

    Important:
    - The registry is NOT a replacement for GitHub cards.
    - GitHub issues remain the source of truth for full card bodies.
    - The registry stores topology + minimal metadata only.

- id: registry_system.allowed_kinds
  kind: meta
  md: |
    Allowed kinds for REGISTRY_SYSTEM:

    - overview
    - meta
    - index
    - reference
    - schema
    - rules
    - process

    If no existing kind fits a new block, follow
    `documentation_protocol.kind_governance`.

- id: registry_system.index
  kind: index
  md: |
    ## REGISTRY_SYSTEM Block Index

    REGISTRY_SYSTEM defines the registry schema and update contract used to index phases and slices.

    ### Blocks in this file

    - `registry_system.overview`
      Purpose, scope, and non-goals of the phase registry.

    - `registry_system.allowed_kinds`
      Allowed block kinds for this file.

    - `registry_system.file_layout`
      Expected on-disk layout for registry files and scripts (conceptual; actual paths must match repo reality).

    - `registry_system.phase_file_schema`
      Schema for per-phase registry files (p0.yml, p1.yml, …).

    - `registry_system.slice_schema`
      Schema for slice/subslice entries (minimal metadata only).

    - `registry_system.registry_index_schema`
      Schema for the master registry index file listing all registry files and scripts.

    - `registry_system.script_contracts`
      Script interface contracts for safe mutation/validation (conceptual).

    - `registry_system.gpt_usage_guidelines`
      Rules of use: read vs modify behavior and constraints.

    ### Explicitly not defined here

    - Planning/decomposition governance (see build_canon and roadmap)
    - Documentation governance (see documentation_protocol)
    - QA governance (see documentation_protocol and qa_reference)

- id: registry_system.locations
  kind: registry
  md: |
    ## 1. File Layout

    Unless otherwise specified, all registry files and scripts live under the build/docs
    area of the repository. Example layout:

    ```text
    docs/
      build/
        registry/
          p0.yml
          p1.yml
          p2.yml
          p3.yml
          p4.yml
          p5.yml
          p6.yml
          p7.yml
          p8.yml
          p8_hd.yml
          p8_dr.yml
          p8_sc.yml
          p9.yml
          p10.yml
          p11.yml
          phase_registry_index.yml
          registry_sync_from_github.py
          registry_validate.py
    ```
    
  Notes:
    - This is a conceptual layout. If repo paths differ, update this block and gpt_resource_index accordingly.
    - GPTs must not assume paths beyond what is documented in gpt_resource_index + tech_spec.

- id: registry_system.phase_file_schema
  kind: schema
  md: |
    ## Phase Registry File Schema (p0.yml, p1.yml, …)

    Each phase registry file follows a shared top-level structure:

    ```yaml
    phase:
      id: p<n>                  # e.g., p0, p1, p8, p8_hd (final format TBD)
      name: "<human-readable phase name>"
      order: <integer>

      description: |
        <short overview>

      structure:
        slices:
          - id: "<slice_id>"
            title: "<card title from GitHub>"
            executor_role: "<architect|implementer|qa>"
            parent: "<phase_or_slice_id>"
            delivers: ["<deliverable_ids>"]
            qa_status: "<pending|in_progress|pass|fail>"
            subslices: []
    ```

    Rules:
    - The registry stores minimal metadata and relationships only.
    - Full card bodies live in GitHub issues, not in the registry.

- id: registry_system.slice_schema
  kind: schema
  md: |
    ## Slice Schema (slices and subslices)

    Each entry in `structure.slices` (and nested `subslices`) is minimal metadata:

    ```yaml
    - id: "<slice_id>"
      title: "<card title from GitHub>"
      executor_role: "<architect|implementer|qa>"
      parent: "<phase_or_slice_id>"
      delivers: ["<deliverable_ids>"]
      qa_status: "<pending|in_progress|pass|fail>"
      subslices: []
    ```

    Important:
    - No card bodies are stored here.
    - This is a topology/index map, not a specification store.
    
- id: registry_system.registry_index_schema
  kind: schema
  md: |
    ## Phase Registry Index Schema (phase_registry_index.yml)

    This file is the master manifest pointing to registry files and the scripts that operate on them.

    Example skeleton:

    ```yaml
    registry_index:
      version: 1
      root_dir: "docs/build/registry"

      phases:
        - id: "p0"
          name: "Phase 0 — Foundations & Tooling"
          file: "p0.yml"
          kind: "phase"
          state: "active"

      scripts:
        - name: "registry_add_or_update_slice"
          path: "docs/build/scripts/registry_add_or_update_slice.py"
          role: "mutation"
          description: "Add or update a slice entry in a phase registry file."

        - name: "registry_validate"
          path: "docs/build/scripts/registry_validate.py"
          role: "validation"
          description: "Validate all registry files and relationships."
    ```

    GPTs should use this index for global discovery of registry files and script locations.

- id: registry_system.script_contracts
  kind: reference
  md: |
    ## Automation Script Contracts (Registry Sync Model)

    The registry is a build-time index and SHOULD be updated by scripts, not by hand.

    Source of truth:
    - GitHub issues on the "LillyCORE Main" project board hold full card bodies.
    - The registry holds topology + minimal metadata only.

    Scripts:
    - `registry_sync_from_github.py`
      - Reads cards from GitHub (via gh CLI) and writes/updates:
        - `docs/build/registry/p<n>.yml` phase files
        - `docs/build/registry/phase_registry_index.yml` manifest (recommended)
    - `registry_validate.py`
      - Validates registry files and relationships (schema, uniqueness, parent links).

    GPT Rule:
    - GPTs MUST NOT hand-edit registry YAML during normal operation.
    - If scripts are missing or fail, GPTs MUST ask Andrew before proposing manual edits.

- id: registry_system.gpt_usage_guidelines
  kind: rules
  md: |
    ## GPT Usage Guidelines (Registry)

    Reading:
    - Prefer GitHub issues for full card bodies.
    - Use registry files for topology/indexing only.

    Updating:
    - Preferred: run `registry_sync_from_github.py` after cards are created/updated.
    - Validate: run `registry_validate.py` as a sanity pass (especially before QA).

    Constraints:
    - Registry entries must remain minimal and non-authoritative.
    - If registry and GitHub disagree, GitHub wins unless Andrew explicitly overrides.
