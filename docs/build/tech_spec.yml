- id: tech_spec.overview
  kind: overview
  md: |
    # tech_spec

    Purpose:
    - Define the technical environment and baseline engineering standards for LillyCORE.
    - Prevent guessing, drift, and cross-platform nonsense.

    Scope:
    - Python runtime baseline
    - Tooling baseline (formatter, linter, tests)
    - Repository-root conventions (where configs live)
    - Minimal execution conventions (how to run checks)

    Out of scope (explicit):
    - Runtime architecture and engine/plugin behavior
    - GPT role behaviour rules (see build_canon and documentation_protocol)
    - Documentation update procedures (see documentation_protocol)

    Phase 1 Local Checks Entrypoint
    Canonical local command for Phase 1 build-time checks:

    python3 docs/build/p1_checks.py

    Behavior:
    - Must be invoked from repository root.
    - Runs checks in deterministic order:
      1. Ruff (lint)
      2. Black (--check, format verification)
      3. Pytest (tests)
    - Exits non-zero on the first failure.
    - Intended to act as a CI gate as well as a local developer check.

    Phase 1 Bootstrap Note (Tests):
    - During early Phase 1 bootstrap, the repository may contain no tests.
    - In this case, Pytest exits with code 5 (“no tests collected”).
    - The canonical Phase 1 checks entrypoint treats Pytest exit code 5 as PASS.
    - Any real test failure (non-zero exit code other than 5) is treated as FAIL.
    - This behavior allows CI to function as a lint/format gate before tests are introduced.

    Notes:
    - This entrypoint is the single supported local invocation for Phase 1 checks.
    - Editor integrations or alternative wrappers are optional conveniences and must delegate to this command.
    - This bootstrap exception applies only to Phase 1; later phases may require tests to exist.


- id: tech_spec.platform_assumptions
  kind: baseline
  md: |
    ## Platform Assumptions

    Primary development platform:
    - Linux (Pop!_OS).

    GPT constraint:
    - GPTs MUST NOT provide Windows/Mac-specific instructions unless Andrew explicitly asks.
    - If cross-platform behavior matters, GPTs MUST ask what targets are required.

- id: tech_spec.python_baseline
  kind: baseline
  md: |
    ## Python Baseline

    Minimum supported Python:
    - Python 3.11+

    Notes:
    - All code, scripts, and tooling choices MUST be compatible with the minimum version.

- id: tech_spec.best_practice_policy
  kind: rules
  md: |
    ## Best-Practice Policy (Default)

    Default stance:
    - Use widely accepted Python best practices to reduce context load and drift.

    Constraint:
    - Best practice MUST be treated as a default, not a law.
    - If best practice conflicts with a LillyCORE requirement, the requirement wins,
      but the exception MUST be documented here.

- id: tech_spec.repo_root_definition
  kind: rules
  md: |
    ## Repository Root Definition

    Definition:
    - "Repository root" = the top-level directory of the lillycore repository
      (the folder containing .git and the main project files).

    Policy:
    - Repository-wide configuration files live at repository root unless explicitly stated otherwise.

- id: tech_spec.tooling_baseline
  kind: baseline
  md: |
    ## Tooling Baseline (Conceptual)

    Purpose:
    - Keep code consistent and catch obvious mistakes early.

    Definitions (plain English):
    - Formatter:
        Automatically rewrites code layout (spacing, wrapping) to a consistent style.
    - Linter:
        Checks code for likely bugs, suspicious patterns, and rule violations.
    - Test framework:
        Runs automated checks to confirm behavior.
    - CI gate:
        A rule that says: "Changes are not considered valid unless required checks pass."

- id: tech_spec.tooling_choices
  kind: decisions
  md: |
    ## Tooling Choices (Authoritative)

    Status:
    - This section is the authoritative list of tooling selections.
    - If a choice is not listed here, it is not selected.

    Current selections:
    - Formatter: Black
    - Linter: Ruff
    - Test framework: Pytest

- id: tech_spec.change_log
  kind: meta
  md: |
    ## Change Log (Lightweight)

    - v1.0: Clean baseline rewrite. Python 3.11+ established. No-guessing + best-practice policy defined.

- id: tech_spec.repo_taxonomy_authority
  kind: rules
  md: |
    ## Repository Taxonomy Authority & Change Process

    Authority:
    - tech_spec is the authoritative source for repository layout and
      folder taxonomy during Phase 0.
    - build_canon governs ontology and planning discipline, not physical layout.

    Rules:
    - Files and folders MUST follow the taxonomy defined in tech_spec.
    - Implementers MUST NOT silently change repository structure.

    Any change to:
    - the set of top-level folders under the repository root, or
    - the meaning or responsibilities of those folders

    MUST:
    - be designed via an Architect-approved card, and
    - update tech_spec accordingly.

    build_canon is updated ONLY when underlying ontology or planning
    discipline changes — not for ordinary layout changes.

- id: tech_spec.allowed_kinds
  kind: meta
  md: |
    Allowed kinds for TECH_SPEC:

    - overview
    - meta
    - index
    - baseline
    - rules
    - decisions
    - reference

    If no existing kind fits a new block, follow
    `documentation_protocol.kind_governance`.

- id: tech_spec.index
  kind: index
  md: |
    ## TECH_SPEC Block Index

    TECH_SPEC defines LillyCORE’s technical environment, tooling,
    repository layout, and execution conventions.

    It prevents guessing and drift during implementation.

    ### Blocks in this file

    - `tech_spec.overview`
      Purpose, scope, and exclusions.

    - `tech_spec.platform_assumptions`
      Supported platforms and GPT constraints.

    - `tech_spec.python_baseline`
      Minimum supported Python version.

    - `tech_spec.best_practice_policy`
      Default best-practice stance and exception policy.

    - `tech_spec.repo_root_definition`
      Definition of repository root and config placement.

    - `tech_spec.tooling_baseline`
      Conceptual description of formatter, linter, tests, CI.

    - `tech_spec.tooling_choices`
      Authoritative tooling selections.

    - `tech_spec.repo_taxonomy_authority`
      Authority and process for changing repository layout.

    - `tech_spec.proof_outputs_convention`
      Required location and rules for execution proof artefacts.

    - `tech_spec.change_log`
      Lightweight change history.

    - `tech_spec.block_loading_tooling`
      Canonical block loading retrieval script (`get_md.py`) and usage rules.

    - `tech_spec.build_artifact_write_scope`
      Where build-time scripts are allowed to write artefacts (docs/build/outputs, plus registry).


    ### Explicitly not defined here

    - System ontology and authority (see BUILD_CANON)
    - Documentation governance (see DOCUMENTATION_PROTOCOL)
    - Phase intent and sequencing (see ROADMAP)
    
- id: tech_spec.proof_outputs_convention
  kind: rules
  md: |
    ## Proof Output Convention (Execution Evidence)

    Any card/phase that requires execution proof MUST store raw proof artefacts under:

    - `docs/build/outputs/<phase_id>/`

    Where `<phase_id>` is the phase or slice identifier (e.g. `p1`, `p1_runtime`, etc.).

    ### Rules
    - Proof artefacts MUST be raw outputs (stdout/stderr captures, logs, test output, JSON dumps, etc.).
    - Proof artefacts are evidence only and are non-authoritative.
    - GPTs MUST NOT “pretty format” proof unless the deliverable explicitly requires a formatted output.

    ### Minimal Manifest (Recommended)
    Each proof folder SHOULD include a minimal manifest file (inventory only), e.g.:
    - `docs/build/outputs/<phase_id>/manifest.txt`

    The manifest SHOULD list:
    - command(s) executed
    - filenames generated
    - timestamp (optional)

    QA may use the manifest to locate evidence quickly.

- id: tech_spec.block_loading_tooling
  kind: rules
  md: |
    ## Block Loading Tooling

    Canonical block retrieval script:
    - `docs/build/get_md.py`

    Rules:
    - GPTs MUST request blocks by ID and may ask Andrew to run `get_md.py` to retrieve them.
    - The script output is treated as an exact extract (non-authoritative evidence of doc contents).
    - The script MUST NOT summarize or transform block content.

- id: tech_spec.build_artifact_write_scope
  kind: rules
  md: |
    ## Build Artefact Write Scope

    Build-time scripts (tooling, validation, registry sync, block utilities) MUST write
    generated artefacts only under:

    - `docs/build/outputs/`

    Registry mutation scripts may additionally write under:
    - `docs/build/registry/`

    Prohibited:
    - creating new top-level folders at repository root
    - writing build artefacts into runtime source folders unless a card explicitly requires it

    QA Enforcement:
    - QA MUST FAIL any card/phase where build-time artefacts are written outside these locations,
      unless Andrew explicitly approves an exception.
